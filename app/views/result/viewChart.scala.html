@(
    user: Option[models.user.User],
    result: models.query.SharedResult,
    columns: Seq[models.query.QueryResult.Col],
    data: Seq[Seq[Option[String]]],
    debug: Boolean
)(implicit request: Request[AnyContent], session: Session, flash: Flash, messages: Messages)
@views.html.layout.simple(user = user, title = messages(result.title), mainDivClass = "", debug = debug) {
  <script>
    var columns = [
      @Html(columns.map { col =>
        s"""{
          "name": "${col.name}",
          "t": "${col.t}"
        }"""
      }.mkString(",\n"))
    ];

    var data = [
      @Html(data.map { row =>
        "[" + row.map { cell =>
          cell.map("\"" + _.trim + "\"").getOrElse("null")
        }.mkString(", ") + "]"
      }.mkString(",\n"))
    ];

    var chart = @Html(result.chart.getOrElse(throw new IllegalStateException()));
  </script>
  <div class="row">
    <div class="col s12">
      <div class="card">
        <div class="card-content">
          <div class="right">
            <a id="chart-settings-link" class="theme-text" href=""><i class="fa @models.template.Icons.settings"></i></a>
          </div>
          <span class="card-title">@result.title</span>
          <div><em>Created on [@result.created] by user [@result.owner]</em></div>

          <div id="chart-@result.id">
            <div id="chart-options" class="chart-options-panel z-depth-1"></div>
            <div id="chart-container">
              <div class="chart-panel"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="@routes.Assets.versioned("lib/plotly.js/dist/plotly-basic.js")" defer="defer"></script>
  <script src="@routes.Assets.versioned("lib/plotly.js/dist/plotly-gl3d.js")" defer="defer"></script>
  @if(debug) {
    <script src="@controllers.routes.Assets.versioned("charting-fastopt.js")" type="text/javascript"></script>
  } else {
    <script src="@controllers.routes.Assets.versioned("charting-opt.js")" type="text/javascript"></script>
  }
  <script>
    $(function() {
      $('#chart-settings-link').on('click', function(){
        $('#chart-options').toggle();
        return false;
      });
      var charting = new Charting();
      charting.init();
      charting.addChart('@result.id', columns, data, chart);
    });
  </script>
}
